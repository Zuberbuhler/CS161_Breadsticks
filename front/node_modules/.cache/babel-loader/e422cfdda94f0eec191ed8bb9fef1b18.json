{"ast":null,"code":"import { x as PlayerView } from './turn-order-0b7dce3d.js';\nimport { createPatch } from 'rfc6902';\n\nconst applyPlayerView = (game, playerID, state) => ({ ...state,\n  G: game.playerView(state.G, state.ctx, playerID),\n  plugins: PlayerView(state, {\n    playerID,\n    game\n  }),\n  deltalog: undefined,\n  _undo: [],\n  _redo: []\n});\n/** Gets a function that filters the TransportData for a given player and game. */\n\n\nconst getFilterPlayerView = game => (playerID, payload) => {\n  switch (payload.type) {\n    case 'patch':\n      {\n        const [matchID, stateID, prevState, state] = payload.args;\n        const log = redactLog(state.deltalog, playerID);\n        const filteredState = applyPlayerView(game, playerID, state);\n        const newStateID = state._stateID;\n        const prevFilteredState = applyPlayerView(game, playerID, prevState);\n        const patch = createPatch(prevFilteredState, filteredState);\n        return {\n          type: 'patch',\n          args: [matchID, stateID, newStateID, patch, log]\n        };\n      }\n\n    case 'update':\n      {\n        const [matchID, state] = payload.args;\n        const log = redactLog(state.deltalog, playerID);\n        const filteredState = applyPlayerView(game, playerID, state);\n        return {\n          type: 'update',\n          args: [matchID, filteredState, log]\n        };\n      }\n\n    case 'sync':\n      {\n        const [matchID, syncInfo] = payload.args;\n        const filteredState = applyPlayerView(game, playerID, syncInfo.state);\n        const log = redactLog(syncInfo.log, playerID);\n        const newSyncInfo = { ...syncInfo,\n          state: filteredState,\n          log\n        };\n        return {\n          type: 'sync',\n          args: [matchID, newSyncInfo]\n        };\n      }\n\n    default:\n      {\n        return payload;\n      }\n  }\n};\n/**\r\n * Redact the log.\r\n *\r\n * @param {Array} log - The game log (or deltalog).\r\n * @param {String} playerID - The playerID that this log is\r\n *                            to be sent to.\r\n */\n\n\nfunction redactLog(log, playerID) {\n  if (log === undefined) {\n    return log;\n  }\n\n  return log.map(logEvent => {\n    // filter for all other players and spectators.\n    if (playerID !== null && +playerID === +logEvent.action.payload.playerID) {\n      return logEvent;\n    }\n\n    if (logEvent.redact !== true) {\n      return logEvent;\n    }\n\n    const payload = { ...logEvent.action.payload,\n      args: null\n    };\n    const filteredEvent = { ...logEvent,\n      action: { ...logEvent.action,\n        payload\n      }\n    };\n    const {\n      redact,\n      ...remaining\n    } = filteredEvent;\n    return remaining;\n  });\n}\n\nexport { getFilterPlayerView as g };","map":{"version":3,"sources":["/Users/andywang/Desktop/CS161_Breadsticks/node_modules/boardgame.io/dist/esm/filter-player-view-c30cdfbf.js"],"names":["x","PlayerView","createPatch","applyPlayerView","game","playerID","state","G","playerView","ctx","plugins","deltalog","undefined","_undo","_redo","getFilterPlayerView","payload","type","matchID","stateID","prevState","args","log","redactLog","filteredState","newStateID","_stateID","prevFilteredState","patch","syncInfo","newSyncInfo","map","logEvent","action","redact","filteredEvent","remaining","g"],"mappings":"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","sourcesContent":["import { x as PlayerView } from './turn-order-0b7dce3d.js';\nimport { createPatch } from 'rfc6902';\n\nconst applyPlayerView = (game, playerID, state) => ({\r\n    ...state,\r\n    G: game.playerView(state.G, state.ctx, playerID),\r\n    plugins: PlayerView(state, { playerID, game }),\r\n    deltalog: undefined,\r\n    _undo: [],\r\n    _redo: [],\r\n});\r\n/** Gets a function that filters the TransportData for a given player and game. */\r\nconst getFilterPlayerView = (game) => (playerID, payload) => {\r\n    switch (payload.type) {\r\n        case 'patch': {\r\n            const [matchID, stateID, prevState, state] = payload.args;\r\n            const log = redactLog(state.deltalog, playerID);\r\n            const filteredState = applyPlayerView(game, playerID, state);\r\n            const newStateID = state._stateID;\r\n            const prevFilteredState = applyPlayerView(game, playerID, prevState);\r\n            const patch = createPatch(prevFilteredState, filteredState);\r\n            return {\r\n                type: 'patch',\r\n                args: [matchID, stateID, newStateID, patch, log],\r\n            };\r\n        }\r\n        case 'update': {\r\n            const [matchID, state] = payload.args;\r\n            const log = redactLog(state.deltalog, playerID);\r\n            const filteredState = applyPlayerView(game, playerID, state);\r\n            return {\r\n                type: 'update',\r\n                args: [matchID, filteredState, log],\r\n            };\r\n        }\r\n        case 'sync': {\r\n            const [matchID, syncInfo] = payload.args;\r\n            const filteredState = applyPlayerView(game, playerID, syncInfo.state);\r\n            const log = redactLog(syncInfo.log, playerID);\r\n            const newSyncInfo = {\r\n                ...syncInfo,\r\n                state: filteredState,\r\n                log,\r\n            };\r\n            return {\r\n                type: 'sync',\r\n                args: [matchID, newSyncInfo],\r\n            };\r\n        }\r\n        default: {\r\n            return payload;\r\n        }\r\n    }\r\n};\r\n/**\r\n * Redact the log.\r\n *\r\n * @param {Array} log - The game log (or deltalog).\r\n * @param {String} playerID - The playerID that this log is\r\n *                            to be sent to.\r\n */\r\nfunction redactLog(log, playerID) {\r\n    if (log === undefined) {\r\n        return log;\r\n    }\r\n    return log.map((logEvent) => {\r\n        // filter for all other players and spectators.\r\n        if (playerID !== null && +playerID === +logEvent.action.payload.playerID) {\r\n            return logEvent;\r\n        }\r\n        if (logEvent.redact !== true) {\r\n            return logEvent;\r\n        }\r\n        const payload = {\r\n            ...logEvent.action.payload,\r\n            args: null,\r\n        };\r\n        const filteredEvent = {\r\n            ...logEvent,\r\n            action: { ...logEvent.action, payload },\r\n        };\r\n        const { redact, ...remaining } = filteredEvent;\r\n        return remaining;\r\n    });\r\n}\n\nexport { getFilterPlayerView as g };\n"]},"metadata":{},"sourceType":"module"}